# 11.6.1 â€” Maps & Navigation (App + Portal)

## Portal maps (web)

Already implemented:
- Mapbox GL JS renders:
  - bay polygons/points
  - sensor markers + clustering
  - paid/free overlay zones

Now added:
- **Driving navigation deep links** from `/portal/map`:
  - Apple Maps directions link
  - Google Maps directions link
  - Uses best-available coordinates:
    1) sensor lat/lng (from calibration)
    2) bay lat/lng
    3) site/zone center

## App maps (ParkSense mobile app)

Recommendation: **Mapbox Maps SDK for React Native** with Expo (config plugin).

Core requirements we will support:
- custom map styles
- offline style packs (later)
- bay overlays (polygons) + state coloring
- sensor markers and clustering (later)

### Expo setup (high level)
- Use Expo SDK 52+ and Expo Router
- Add Mapbox RN dependency (e.g. `@rnmapbox/maps`) and the Expo config plugin
- Provide `MAPBOX_ACCESS_TOKEN` in app config

### Navigation (immediate, production-grade)

Do **not** implement turn-by-turn inside the app for MVP.
Use native navigation deep links:
- Apple Maps: `https://maps.apple.com/?daddr=LAT,LNG&dirflg=d`
- Google Maps: `https://www.google.com/maps/dir/?api=1&destination=LAT,LNG&travelmode=driving`

Example (Expo):

```ts
import { Linking, Platform } from 'react-native'

export function openDirections(lat: number, lng: number) {
  const apple = `https://maps.apple.com/?daddr=${lat},${lng}&dirflg=d`
  const google = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}&travelmode=driving`

  // Keep it simple: on iOS use Apple by default, Android use Google.
  const url = Platform.OS === 'ios' ? apple : google
  return Linking.openURL(url)
}
```

### Later: in-app turn-by-turn

After MVP (once we have stable bay overlays + routing logic), we can add:
- in-app navigation view
- CarPlay/Android Auto driving UI integration

## Viable alternative

If we prioritize routing accuracy and traffic above custom styling:
- Google Maps Platform:
  - Maps SDK (mobile)
  - Directions/Traffic
  - still keep bay overlays via polygons, but styling is less flexible than Mapbox.



