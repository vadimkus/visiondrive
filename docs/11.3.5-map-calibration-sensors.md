# 11.3.5 Map Calibration (Sensors) — drag & fix location + 3D + satellite

This adds a dedicated admin page to manually correct sensor placement on the map.

## Why

Real installations often need a “field calibration” step:

- sensor GPS/placement may be slightly off
- bay polygons might be correct, but sensor marker is wrong
- operators need a quick tool to drag + save

## What was implemented

### Portal page

- `GET /portal/calibration`

Features:

- Search + select sensor
- Draggable marker to set correct position
- Save to DB
- Toggles:
  - Satellite view
  - 3D mode (pitch + 3D buildings layer where available)

### Admin APIs

- `GET /api/portal/admin/sensors`
  - list sensors (tenant-scoped, admin-only) including lat/lng and bay/zone/site labels
- `POST /api/portal/admin/sensors/:id/location`
  - update `sensors.lat/lng` (tenant-scoped, admin-only)

## Permissions

Only:

- `MASTER_ADMIN`
- `CUSTOMER_ADMIN`

## How to use

1) Ensure Mapbox token is set:

- `NEXT_PUBLIC_MAPBOX_ACCESS_TOKEN`

2) Open:

- `/portal/calibration`

3) Pick a sensor:

- Drag marker to exact spot
- Click **Save**

## Notes

- This updates **sensor location** only (not bay polygons). For bay polygon editing, we’ll add a separate polygon editor later.
- Follow-up UX improvements (installed-only=40, all-sensors overlay, stable map on save, portal map sensor coords) are documented in `docs/11.3.6-calibration-ux-all-sensors-installed-only.md`.


