# System Architecture

## VisionDrive Smart Kitchen - Technical Architecture

---

## ğŸ‡¦ğŸ‡ª UAE Data Residency Compliance

**All customer data is stored exclusively in AWS me-central-1 (Abu Dhabi, UAE)**

> âš ï¸ **Note:** Amazon Timestream is NOT available in UAE region. Using DynamoDB for time-series data instead.

| Data Type | Storage | Location | Compliance |
|-----------|---------|----------|------------|
| Users & Authentication | DynamoDB | me-central-1 | âœ… UAE |
| Sensor Readings | DynamoDB (VisionDrive-SensorReadings) | me-central-1 | âœ… UAE |
| Device Configs | DynamoDB (VisionDrive-Devices) | me-central-1 | âœ… UAE |
| Alerts & Events | DynamoDB (VisionDrive-Alerts) | me-central-1 | âœ… UAE |
| Frontend Assets | Vercel CDN | Global | âœ… No PII |

---

## ğŸ›ï¸ Dubai Municipality Food Safety Compliance

**Reference Document:** DM-HSD-GU46-KFPA2 (Version 3, May 9, 2024)

### Implemented Temperature Thresholds

| Equipment Type | Arabic | Required Temp | Status |
|---------------|--------|---------------|--------|
| Walk-in Fridge | ØºØ±ÙØ© ØªØ¨Ø±ÙŠØ¯ | 0Â°C to 5Â°C | âœ… Monitoring |
| Main Freezer | ÙØ±ÙŠØ²Ø± | â‰¤ -18Â°C | âœ… Monitoring |
| Prep Area Fridge | Ø«Ù„Ø§Ø¬Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ± | 0Â°C to 5Â°C | âœ… Monitoring |
| Main Cooler | Ø«Ù„Ø§Ø¬Ø© | 0Â°C to 5Â°C | âœ… Monitoring |
| Display Fridge | Ø«Ù„Ø§Ø¬Ø© Ø¹Ø±Ø¶ | 0Â°C to 5Â°C | âœ… Monitoring |
| Hot Bain-Marie | Ø­ÙØ¸ Ø³Ø§Ø®Ù† | â‰¥ 60Â°C | âœ… Monitoring |
| Blast Chiller | Ù…Ø¨Ø±Ø¯ Ø³Ø±ÙŠØ¹ | -10Â°C to 3Â°C | âœ… Monitoring |
| **Danger Zone** | **Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±** | **5Â°C - 60Â°C** | âš ï¸ **Alert** |
| Cooking Temp | Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø·Ù‡ÙŠ | â‰¥ 75Â°C core | âœ… Monitoring |

### Compliance Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DM COMPLIANCE PROCESSING FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   Sensor Reading                    Frontend                   User
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€
        â”‚                               â”‚                         â”‚
        â–¼                               â”‚                         â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚                         â”‚
   â”‚ Temperature  â”‚                     â”‚                         â”‚
   â”‚   25.5Â°C     â”‚                     â”‚                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚                         â”‚
          â”‚                             â”‚                         â”‚
          â–¼                             â”‚                         â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                  COMPLIANCE LIBRARY                          â”‚
   â”‚                  (lib/compliance.ts)                         â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                                              â”‚
   â”‚  checkCompliance(25.5, 'walk-in-fridge')                     â”‚
   â”‚       â†“                                                      â”‚
   â”‚  1. Load equipment threshold (0Â°C to 5Â°C)                    â”‚
   â”‚  2. Check if temp in range â†’ NO                              â”‚
   â”‚  3. Check danger zone (5Â°C - 60Â°C) â†’ YES âš ï¸                  â”‚
   â”‚  4. Return { status: 'danger', message: 'DANGER ZONE' }      â”‚
   â”‚                                                              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                     DASHBOARD UI                             â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                                              â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
   â”‚  â”‚  ğŸšª Walk-in Fridge        âš ï¸ DANGER                 â”‚    â”‚
   â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚    â”‚
   â”‚  â”‚  Current: 25.5Â°C          Required: 0Â°C to 5Â°C     â”‚    â”‚
   â”‚  â”‚  [âŒ Non-Compliant]        Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±             â”‚    â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
   â”‚                                                              â”‚
   â”‚  Compliance Rate: 75% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘                            â”‚
   â”‚  Danger Zone Events: 3 âš ï¸                                    â”‚
   â”‚                                                              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                     COMPLIANCE STATUS TYPES
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                                              â”‚
   â”‚  âœ… COMPLIANT   â”‚ Temperature within DM requirements         â”‚
   â”‚  âš ï¸ WARNING     â”‚ Temperature slightly out of range          â”‚
   â”‚  âŒ CRITICAL    â”‚ Temperature significantly out of range     â”‚
   â”‚  ğŸ”´ DANGER      â”‚ Temperature in danger zone (5Â°C - 60Â°C)    â”‚
   â”‚                                                              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     VISIONDRIVE SMART KITCHEN ARCHITECTURE                  â”‚
â”‚                     ğŸ‡¦ğŸ‡ª All Data Stored in UAE (me-central-1)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              SENSOR LAYER
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ PS-NB-GE  â”‚    â”‚ PS-NB-GE  â”‚    â”‚ PS-NB-GE  â”‚    â”‚ PS-NB-GE  â”‚        â”‚
â”‚   â”‚ Kitchen 1 â”‚    â”‚ Kitchen 2 â”‚    â”‚ Kitchen 3 â”‚    â”‚ Kitchen N â”‚        â”‚
â”‚   â”‚   ğŸŒ¡ï¸ 4Â°C   â”‚    â”‚   ğŸŒ¡ï¸ 3Â°C   â”‚    â”‚   ğŸŒ¡ï¸ 5Â°C   â”‚    â”‚   ğŸŒ¡ï¸ 4Â°C   â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                â”‚                â”‚                â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                   â”‚                                        â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                          â”‚   du NB-IoT     â”‚                              â”‚
â”‚                          â”‚   Network (UAE) â”‚                              â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                   â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ MQTTs (Port 8883)
                                    â”‚
                         CLOUD LAYER (AWS me-central-1 UAE) ğŸ‡¦ğŸ‡ª
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                   â”‚                                        â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                          â”‚  AWS IoT Core   â”‚                              â”‚
â”‚                          â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                              â”‚
â”‚                          â”‚  â€¢ MQTT Broker  â”‚                              â”‚
â”‚                          â”‚  â€¢ Device Reg.  â”‚                              â”‚
â”‚                          â”‚  â€¢ Rules Engine â”‚                              â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                   â”‚                                        â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚         â”‚                         â”‚                         â”‚             â”‚
â”‚         â–¼                         â–¼                         â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Lambda    â”‚         â”‚   Lambda    â”‚         â”‚   Lambda    â”‚         â”‚
â”‚  â”‚  Ingestion  â”‚         â”‚   Alerts    â”‚         â”‚    Auth     â”‚         â”‚
â”‚  â”‚             â”‚         â”‚             â”‚         â”‚             â”‚         â”‚
â”‚  â”‚ â€¢ Parse mA  â”‚         â”‚ â€¢ Check DM  â”‚         â”‚ â€¢ Login     â”‚         â”‚
â”‚  â”‚ â€¢ ConvertÂ°C â”‚         â”‚   thresholdsâ”‚         â”‚ â€¢ JWT issue â”‚         â”‚
â”‚  â”‚ â€¢ Validate  â”‚         â”‚ â€¢ Send SNS  â”‚         â”‚ â€¢ Verify    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                       â”‚                       â”‚                 â”‚
â”‚         â–¼                       â–¼                       â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  DynamoDB   â”‚         â”‚  DynamoDB   â”‚         â”‚  DynamoDB   â”‚         â”‚
â”‚  â”‚             â”‚         â”‚             â”‚         â”‚             â”‚         â”‚
â”‚  â”‚ Time-series â”‚         â”‚ â€¢ Alerts    â”‚         â”‚ â€¢ Users     â”‚         â”‚
â”‚  â”‚ temperature â”‚         â”‚ â€¢ Devices   â”‚         â”‚ â€¢ Auth      â”‚         â”‚
â”‚  â”‚ data        â”‚         â”‚ â€¢ Kitchens  â”‚         â”‚ â€¢ Sessions  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                                               â”‚                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                            â”‚                                              â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                   â”‚  API Gateway    â”‚                                    â”‚
â”‚                   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                                    â”‚
â”‚                   â”‚  REST API       â”‚                                    â”‚
â”‚                   â”‚  /api/auth      â”‚  â—„â”€â”€ Auth endpoints                â”‚
â”‚                   â”‚  /api/sensors   â”‚                                    â”‚
â”‚                   â”‚  /api/kitchens  â”‚                                    â”‚
â”‚                   â”‚  /api/alerts    â”‚                                    â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                            â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ HTTPS (API calls to UAE)
                             â”‚
                       PRESENTATION LAYER (Vercel - No Data Storage)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            â”‚                                              â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                   â”‚    Next.js      â”‚                                    â”‚
â”‚                   â”‚   Dashboard     â”‚                                    â”‚
â”‚                   â”‚                 â”‚                                    â”‚
â”‚                   â”‚ âš ï¸ NO DATA      â”‚                                    â”‚
â”‚                   â”‚    STORED HERE  â”‚                                    â”‚
â”‚                   â”‚                 â”‚                                    â”‚
â”‚                   â”‚ All API calls   â”‚                                    â”‚
â”‚                   â”‚ go to AWS UAE   â”‚                                    â”‚
â”‚                   â”‚                 â”‚                                    â”‚
â”‚                   â”‚ DM Compliance   â”‚â—„â”€â”€ Compliance checks              â”‚
â”‚                   â”‚ lib/compliance  â”‚    run in frontend                â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1.1 Customer Access Flow

Kitchen businesses access their data via the VisionDrive portal:

```
                         CUSTOMER ACCESS FLOW
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   ğŸ–¥ï¸ DESKTOP                           ğŸ“± MOBILE                         â”‚
â”‚   Browser                              App / Browser                     â”‚
â”‚      â”‚                                      â”‚                            â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                     â”‚                                                    â”‚
â”‚                     â–¼                                                    â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚      â”‚  https://www.visiondrive.ae  â”‚                                   â”‚
â”‚      â”‚          /login              â”‚                                   â”‚
â”‚      â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                   â”‚
â”‚      â”‚  Portal: [Kitchen ğŸ³]        â”‚â—„â”€â”€ Portal selector                â”‚
â”‚      â”‚  Username: chef@restaurant.aeâ”‚                                   â”‚
â”‚      â”‚  Password: â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢          â”‚                                   â”‚
â”‚      â”‚  [Login]                     â”‚                                   â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                     â”‚                                                    â”‚
â”‚                     â–¼ Authenticate                                       â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚      â”‚   AWS API Gateway (UAE)      â”‚                                   â”‚
â”‚      â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                   â”‚
â”‚      â”‚  â€¢ Validate credentials      â”‚                                   â”‚
â”‚      â”‚  â€¢ Check user role           â”‚                                   â”‚
â”‚      â”‚  â€¢ Get customerId            â”‚                                   â”‚
â”‚      â”‚  â€¢ Issue JWT token           â”‚                                   â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                     â”‚                                                    â”‚
â”‚                     â–¼ Redirect to Dashboard                              â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚      â”‚  /portal/smart-kitchen       â”‚                                   â”‚
â”‚      â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                   â”‚
â”‚      â”‚  ğŸ“Š DM Compliance Dashboard  â”‚                                   â”‚
â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                   â”‚
â”‚      â”‚  â”‚ Compliance Rate: 92%   â”‚ â”‚                                   â”‚
â”‚      â”‚  â”‚ Danger Zones: 0        â”‚ â”‚                                   â”‚
â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                   â”‚
â”‚      â”‚                              â”‚                                   â”‚
â”‚      â”‚  ğŸ  My Kitchens              â”‚                                   â”‚
â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                                   â”‚
â”‚      â”‚  â”‚Kitchen 1â”‚ â”‚Kitchen 2â”‚     â”‚â—„â”€â”€ Only shows kitchens            â”‚
â”‚      â”‚  â”‚âœ… 95%   â”‚ â”‚âœ… 88%   â”‚     â”‚    owned by this customer        â”‚
â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                                   â”‚
â”‚      â”‚                              â”‚                                   â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                         MULTI-TENANT ISOLATION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚  Customer A (Restaurant Al Barsha)     Customer B (Hotel Marina)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ âœ… Kitchen A1                â”‚     â”‚ âœ… Kitchen B1                â”‚  â”‚
â”‚  â”‚ âœ… Kitchen A2                â”‚     â”‚ âœ… Kitchen B2                â”‚  â”‚
â”‚  â”‚ âŒ Cannot see Kitchen B1/B2  â”‚     â”‚ âŒ Cannot see Kitchen A1/A2  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  VisionDrive Admin                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚ âœ… ALL Kitchens (A1, A2, B1, B2)                                     â”‚
â”‚  â”‚ âœ… All Customers                                                     â”‚
â”‚  â”‚ âœ… System Settings                                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Data Flow

### 2.1 Sensor â†’ Cloud (Uplink)

```
Step 1: Sensor Reading
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PS-NB-GE reads temperature probe (4-20mA)
â”œâ”€â”€ Every 5 minutes (configurable via AT+TDC)
â”œâ”€â”€ On threshold breach (AT+ROC feature)
â””â”€â”€ On manual trigger (button press)

Step 2: Data Transmission
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Sensor â†’ du NB-IoT â†’ AWS IoT Core
â”œâ”€â”€ Protocol: MQTTs (TLS 1.2)
â”œâ”€â”€ Port: 8883
â”œâ”€â”€ Topic: visiondrive/kitchen/{kitchenId}/temperature
â””â”€â”€ Payload: JSON

Step 3: IoT Rules Processing
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
AWS IoT Rules Engine triggers:
â”œâ”€â”€ Rule 1: ALL data â†’ Lambda (Ingestion) â†’ DynamoDB
â”œâ”€â”€ Rule 2: temp in danger zone â†’ Lambda (Alerts) â†’ SNS
â””â”€â”€ Rule 3: Daily â†’ Lambda (Analytics) â†’ S3

Step 4: Storage
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
DynamoDB stores time-series data:
â”œâ”€â”€ Partition Key: sensorId + date
â”œâ”€â”€ Sort Key: timestamp
â”œâ”€â”€ Attributes: temperature, humidity, battery
â””â”€â”€ TTL: 90 days (configurable)
```

### 2.2 Compliance Processing

```
Step 1: Frontend receives sensor data
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
API returns: { temperature: 8.5, equipmentType: 'walk-in-fridge' }

Step 2: Compliance check (lib/compliance.ts)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
checkCompliance(8.5, 'walk-in-fridge')
â”œâ”€â”€ Load threshold: { min: 0, max: 5, type: 'range' }
â”œâ”€â”€ Check: 8.5 > 5 â†’ OUT OF RANGE
â”œâ”€â”€ Check danger zone: 5 < 8.5 < 60 â†’ DANGER ZONE âš ï¸
â””â”€â”€ Return: { status: 'danger', message: 'DANGER ZONE' }

Step 3: UI Update
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€â”€ Sensor card shows: ğŸ”´ DANGER badge
â”œâ”€â”€ Dashboard counter: Danger Zones +1
â”œâ”€â”€ Compliance rate: Recalculated
â””â”€â”€ Alert may be triggered
```

### 2.3 Cloud â†’ Sensor (Downlink)

```
Dashboard â†’ API Gateway â†’ Lambda â†’ IoT Core â†’ Sensor

Commands:
â”œâ”€â”€ Change transmission interval
â”œâ”€â”€ Update alert thresholds
â”œâ”€â”€ Request immediate reading
â””â”€â”€ Firmware update trigger
```

---

## 3. Database Schema

### 3.1 Amazon DynamoDB Tables

```
Table: VisionDrive-Devices
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Partition Key: PK (String)
Sort Key: SK (String)

USER RECORDS (for authentication):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PK: USER#admin@kitchen.ae                                   â”‚
â”‚ SK: METADATA                                                â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ email: "admin@kitchen.ae"                                   â”‚
â”‚ passwordHash: "$2b$10$..."                                  â”‚
â”‚ name: "Kitchen Admin"                                       â”‚
â”‚ role: "ADMIN"                                               â”‚
â”‚ createdAt: "2026-01-11"                                     â”‚
â”‚ lastLogin: "2026-01-12T14:00:00Z"                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

KITCHEN RECORDS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PK: KITCHEN#kitchen-001                                     â”‚
â”‚ SK: METADATA                                                â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ customerId: "cust-001"                                      â”‚
â”‚ name: "Main Kitchen"                                        â”‚
â”‚ address: "Dubai Marina, Building A"                         â”‚
â”‚ manager: "John Smith"                                       â”‚
â”‚ sensorCount: 5                                              â”‚
â”‚ complianceRate: 92.5  â—„â”€â”€ Cached compliance %               â”‚
â”‚ createdAt: "2026-01-01"                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DEVICE RECORDS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PK: DEVICE#sensor-001                                       â”‚
â”‚ SK: METADATA                                                â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ kitchenId: "kitchen-001"                                    â”‚
â”‚ customerId: "cust-001"                                      â”‚
â”‚ location: "Walk-in Fridge"                                  â”‚
â”‚ equipmentType: "walk-in-fridge" â—„â”€â”€ DM equipment type       â”‚
â”‚ probeModel: "PT100"                                         â”‚
â”‚ alertThresholds: { min: 0, max: 5 }                         â”‚
â”‚ status: "active"                                            â”‚
â”‚ lastReading: { temp: 4.2, time: "2026-01-12T14:30:00Z" }   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Table: VisionDrive-SensorReadings
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Partition Key: PK (String) - sensorId#YYYY-MM-DD
Sort Key: SK (String) - timestamp

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PK: sensor-001#2026-01-12                                   â”‚
â”‚ SK: 2026-01-12T14:30:00Z                                    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ sensorId: "sensor-001"                                      â”‚
â”‚ kitchenId: "kitchen-001"                                    â”‚
â”‚ temperature: 4.2                                            â”‚
â”‚ humidity: 65.0                                              â”‚
â”‚ battery: 3.52                                               â”‚
â”‚ signal: -85                                                 â”‚
â”‚ complianceStatus: "compliant" â—„â”€â”€ Pre-calculated            â”‚
â”‚ TTL: 1736956200 (expires in 90 days)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Table: VisionDrive-Alerts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Partition Key: PK (String)
Sort Key: SK (String)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PK: KITCHEN#kitchen-001                                     â”‚
â”‚ SK: ALERT#2026-01-12T10:30:00Z                             â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ deviceId: "sensor-001"                                      â”‚
â”‚ alertType: "DANGER_ZONE"  â—„â”€â”€ DM compliance alert           â”‚
â”‚ severity: "danger"                                          â”‚
â”‚ temperature: 12.5                                           â”‚
â”‚ threshold: { min: 0, max: 5 }                               â”‚
â”‚ message: "Temperature in danger zone (5Â°C - 60Â°C)"          â”‚
â”‚ acknowledged: false                                         â”‚
â”‚ acknowledgedBy: null                                        â”‚
â”‚ resolvedAt: null                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. API Design

### 4.1 REST Endpoints

```
Base URL: https://w7gfk5cka2.execute-api.me-central-1.amazonaws.com/prod/

âš ï¸ All endpoints require authentication via JWT token
   Header: Authorization: Bearer <token>
   Token obtained via /auth/login

AUTHENTICATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST   /auth/login                  Login (returns JWT)
POST   /auth/register               Register (requires adminKey)

KITCHENS (filtered by customer)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET    /kitchens                    List kitchens
GET    /kitchens/{id}               Get kitchen details
POST   /kitchens                    Create new kitchen

SENSORS
â”€â”€â”€â”€â”€â”€â”€
GET    /sensors                     List all sensors
GET    /sensors/{id}                Get sensor details
POST   /sensors                     Register new sensor
PUT    /sensors/{id}                Update sensor config

READINGS
â”€â”€â”€â”€â”€â”€â”€â”€
GET    /sensors/{id}/readings       Get temperature history
GET    /sensors/{id}/current        Get latest reading

ALERTS
â”€â”€â”€â”€â”€â”€
GET    /alerts                      List all alerts
PUT    /alerts/{id}/acknowledge     Acknowledge alert
```

### 4.2 Example Responses

```json
// GET /sensors/sensor-001/current
{
  "sensorId": "sensor-001",
  "kitchenId": "kitchen-001",
  "location": "Walk-in Fridge",
  "equipmentType": "walk-in-fridge",
  "temperature": 4.2,
  "humidity": 65.0,
  "battery": 3.52,
  "timestamp": "2026-01-12T14:30:00Z",
  "compliance": {
    "status": "compliant",
    "message": "Compliant: 0Â°C to 5Â°C",
    "dmReference": "DM Food Code: Cold storage 0Â°C to 5Â°C"
  }
}

// GET /alerts
{
  "alerts": [
    {
      "id": "alert-001",
      "deviceId": "sensor-003",
      "kitchenId": "kitchen-002",
      "type": "DANGER_ZONE",
      "severity": "danger",
      "temperature": 25.5,
      "message": "DANGER ZONE: Food unsafe. Temperature in 5-60Â°C range",
      "createdAt": "2026-01-12T10:25:00Z",
      "acknowledged": false
    }
  ],
  "totalActive": 1
}
```

---

## 5. Security Architecture

### 5.1 Device Security

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SECURITY LAYERS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  TRANSPORT SECURITY                                         â”‚
â”‚  â”œâ”€â”€ TLS 1.2/1.3 for all communications                    â”‚
â”‚  â”œâ”€â”€ MQTTs (port 8883) for sensor â†’ cloud                  â”‚
â”‚  â””â”€â”€ HTTPS for API calls                                   â”‚
â”‚                                                             â”‚
â”‚  DEVICE AUTHENTICATION                                      â”‚
â”‚  â”œâ”€â”€ X.509 certificates per device                         â”‚
â”‚  â”œâ”€â”€ Or custom authorizer with token                       â”‚
â”‚  â””â”€â”€ Device provisioning via AWS IoT                       â”‚
â”‚                                                             â”‚
â”‚  API SECURITY                                               â”‚
â”‚  â”œâ”€â”€ API Gateway with rate limiting                        â”‚
â”‚  â”œâ”€â”€ JWT tokens for user authentication                    â”‚
â”‚  â”œâ”€â”€ Dual JWT verification (Kitchen vs Parking)            â”‚
â”‚  â””â”€â”€ CORS enabled for visiondrive.ae                       â”‚
â”‚                                                             â”‚
â”‚  DATA SECURITY                                              â”‚
â”‚  â”œâ”€â”€ Encryption at rest (AWS managed keys)                 â”‚
â”‚  â”œâ”€â”€ Data residency in UAE (me-central-1)                  â”‚
â”‚  â””â”€â”€ No PII stored outside UAE                             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 User Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DUAL-PORTAL AUTHENTICATION FLOW                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  LOGIN PORTAL: https://www.visiondrive.ae/login             â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  1. User selects portal                             â”‚   â”‚
â”‚  â”‚     â””â”€â”€ Kitchen ğŸ³ or Parking ğŸ…¿ï¸                    â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  2. User enters credentials                         â”‚   â”‚
â”‚  â”‚     â””â”€â”€ Email + Password                            â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  3. Frontend routes to appropriate backend          â”‚   â”‚
â”‚  â”‚     â”œâ”€â”€ Kitchen â†’ AWS API (UAE)                     â”‚   â”‚
â”‚  â”‚     â””â”€â”€ Parking â†’ Vercel API (TimescaleDB)          â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  4. JWT token issued                                â”‚   â”‚
â”‚  â”‚     â”œâ”€â”€ Kitchen JWT â†’ SMART_KITCHEN_JWT_SECRET      â”‚   â”‚
â”‚  â”‚     â””â”€â”€ Parking JWT â†’ JWT_SECRET                    â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  5. Portal cookie set                               â”‚   â”‚
â”‚  â”‚     â””â”€â”€ portal=kitchen or portal=parking            â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  6. Redirect to dashboard                           â”‚   â”‚
â”‚  â”‚     â”œâ”€â”€ Kitchen â†’ /portal/smart-kitchen             â”‚   â”‚
â”‚  â”‚     â””â”€â”€ Parking â†’ /portal                           â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  SESSION VERIFICATION (/api/auth/me)                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”‚
â”‚  1. Read portal cookie                                      â”‚
â”‚  2. If portal=kitchen â†’ verify with SMART_KITCHEN_JWT_SECRETâ”‚
â”‚  3. If portal=parking â†’ verify with JWT_SECRET              â”‚
â”‚  4. Return user data                                        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Frontend Architecture

### 6.1 Portal Structure

```
app/portal/smart-kitchen/
â”œâ”€â”€ page.tsx                # Overview dashboard
â”‚                           # - Compliance rate
â”‚                           # - Danger zone counter
â”‚                           # - Kitchen cards
â”‚                           # - Temperature zones
â”‚
â”œâ”€â”€ layout.tsx              # Kitchen portal layout
â”‚                           # - Dark sidebar
â”‚                           # - Weather header
â”‚
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ compliance.ts       # DM compliance library
â”‚                           # - Equipment types
â”‚                           # - Arabic translations
â”‚                           # - checkCompliance()
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ KitchenSidebar.tsx  # Apple-like dark sidebar
â”‚   â”‚                       # - Real-time clock
â”‚   â”‚                       # - Kitchen-only navigation
â”‚   â”‚                       # - Alert badge
â”‚   â”‚
â”‚   â”œâ”€â”€ KitchenHeader.tsx   # Weather header
â”‚   â”œâ”€â”€ AlertsPanel.tsx     # Alert notifications
â”‚   â”œâ”€â”€ SensorGrid.tsx      # Sensor cards
â”‚   â””â”€â”€ TemperatureChart.tsx # Temp history chart
â”‚
â”œâ”€â”€ kitchens/page.tsx       # Kitchen list
â”œâ”€â”€ sensors/page.tsx        # Sensor grid with equipment types
â”œâ”€â”€ alerts/page.tsx         # Alert management
â”œâ”€â”€ reports/page.tsx        # Analytics
â”œâ”€â”€ settings/page.tsx       # DM requirements reference
â””â”€â”€ compliance/page.tsx     # Full compliance report
```

### 6.2 Compliance Library

```typescript
// lib/compliance.ts

export const DM_COMPLIANCE_GUIDELINES = {
  'walk-in-fridge': {
    id: 'walk-in-fridge',
    name: 'Walk-in Fridge',
    arabicName: 'ØºØ±ÙØ© ØªØ¨Ø±ÙŠØ¯',
    emoji: 'ğŸšª',
    compliance: { min: 0, max: 5, type: 'range' }
  },
  'main-freezer': {
    id: 'main-freezer',
    name: 'Main Freezer',
    arabicName: 'ÙØ±ÙŠØ²Ø±',
    emoji: 'â„ï¸',
    compliance: { max: -18, type: 'max' }
  },
  'hot-bain-marie': {
    id: 'hot-bain-marie',
    name: 'Hot Bain-Marie',
    arabicName: 'Ø­ÙØ¸ Ø³Ø§Ø®Ù†',
    emoji: 'ğŸ”¥',
    compliance: { min: 60, type: 'min' }
  },
  'danger-zone': {
    id: 'danger-zone',
    name: 'Danger Zone',
    arabicName: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±',
    emoji: 'âš ï¸',
    compliance: { min: 5, max: 60, type: 'range' }
  }
  // ... more equipment types
}

export function checkCompliance(temp, equipmentType) {
  // Returns: { status, message, emoji }
  // status: 'compliant' | 'warning' | 'critical' | 'danger'
}
```

---

## 7. Scalability

| Component | Current | Scalable To |
|-----------|---------|-------------|
| Sensors | 10 | 10,000+ |
| Kitchens | 5 | 1,000+ |
| Readings/day | 2,880 | 1M+ |
| Concurrent API requests | 10 | 10,000+ |

All AWS services used are fully managed and auto-scale.

---

## 8. Compliance Summary

| Requirement | Status | Implementation |
|-------------|--------|----------------|
| UAE Data Residency | âœ… | All data in me-central-1 |
| DM Temperature Thresholds | âœ… | lib/compliance.ts |
| Danger Zone Alerts | âœ… | Real-time monitoring |
| Equipment Categorization | âœ… | 8 equipment types |
| Arabic Support | âœ… | All equipment names |
| Compliance Reporting | âœ… | /compliance page |
| Audit Trail | âœ… | DynamoDB logging |
